<!doctype html>
<html>
	<head>
		<title>King of the jungle remix</title>
		<meta charset="utf-8" />
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-6297000-24']);
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
	</head>
	<body>
		<p>
			Here's a remix of my <a href="http://js1k.com/2013-spring/demo/1530">js1k entry</a>.
			It seems to perform the best in Chrome.
		</p>
		<canvas id="c"></canvas>
		<script>
			var b = document.body;
			var c = document.getElementsByTagName('canvas')[0];
			var a = c.getContext('2d');
			document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
		</script>
		<script>
// start of submission //
for(var l=["head0.png","head1.png","head2.png","head3.png","leaf.png"],r,s=l,t={},v=0;v<s.length;v++){var w=s[v],x=new Image;x.src=w;t[w]=x}r=t;function y(b){return b[Math.floor(Math.random()*b.length)]}var z=Math.PI,A=Math.random,B=Math.min,C=c.width=h=c.height=500,D=C/2,E=h/2,F=7;
function G(b,f,g,d,k,e,p){var m=Math.sqrt(B(b.c,b.e)/b.e),q=m*b.length;p+=b.g+0.02*Math.cos(H);var K=q*Math.cos(p)+k,q=q*Math.sin(p)+e;a.strokeStyle="rgb(0,100,0)";if(b.f){var n=r[b.f],u=0.7*d*n.width*m,m=0.7*d*n.height*m;k=D-d*(k+g);e=E+d*e;a.save();a.translate(k,e);a.rotate(-p-0.5*Math.PI);a.translate(-u/2,-m/2);a.drawImage(n,0,0,u,m);a.restore()}else a.beginPath(),a.lineWidth=3*m*d,a.moveTo(D-d*(k+g),E+d*e),a.lineTo(D-d*(K+g),E+d*q),a.stroke();b.c+=f;if(b.c>=b.h&&0<b.a)if(b.a-=1,e=b.d,0>=b.a&&
!e.length)e.push(I(length,0,0,y(["leaf.png"]))),e.push(I(length,0,0,y(l)));else{for(;0<b.a;)k=Math.ceil(A()*b.a),n=40*(A()+0.5),u=0.4*z*(A()-0.5),n=I(n,u,k),b.a-=k,e.push(n);e.push(I(length,0,0,y(["leaf.png"])))}for(e=0;e<b.d.length;e++)G(b.d[e],f,g,d,K,q,p)}function I(b,f,g,d){return{a:g,length:b,d:[],g:f,c:0,h:1,e:3,f:d||""}}var H=0,J,L=[];function M(b,f){return{x:b,b:f,i:I(40,-0.5*z+A()-0.5,B(H+10,38))}}function N(){var b=C*A()+65;0.5<A()&&(b=-b);return b}
function O(){var b=(new Date).getTime(),f=(b-(J||b))/700;J=b;a.clearRect(0,0,C,h);var b=f*B(H/5,1),g;for(g in L){var d=L[g];G(d.i,f,d.x,1/d.b,0,190,0);d.b-=b;0>d.b&&(L[g]=M(N(),F))}L.sort(function(b,d){return d.b-b.b});requestAnimFrame(O,20);H+=f}for(i=0;50>i;i++)L.push(M(N(),A()*F+0.1));window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)};O();
// end of submission //
		</script>
	</body>
</html>
